<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Calcul de Prix Offre Climatisation</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2pdf.js/0.10.1/html2pdf.bundle.min.js"></script>
    <link rel="stylesheet" href="styles/index.css">
    <script src="scripts/index.js"></script>
</head>
<body>
    <div class="container">
    <div class="header">
            <img src="logo-header.png" alt="Logo" class="header-logo">
            <div class="header-content">
                <div class="nav-links">
                    <a href="index.html" class="active">Accueil</a>
                    <a href="History.html">Historique</a>
                    <a href="clients.html">Clients</a>
                    <a href="manage_items.html">Gérer les articles</a>
                </div>
                <div class="quote-id-container">
                    <span>ID Devis: </span>
                    <span id="quote-id-display" class="quote-id"></span>
                </div>
                <h1>CALCUL DE PRIX OFFRE CLIMATISATION</h1>
            </div>
            <div style="width: 150px;"></div> <!-- Spacer for alignment -->
        </div>
    </div>

    <div class="info-section">
        <div class="info-grid">
            <div class="info-label">CLIENT:</div>
            <div class="info-value">
                <select id="client-input" style="width: 100%; padding: 5px;" onchange="updateSiteOptions()">
                    <option value="">Sélectionnez un client</option>
                </select>
            </div>
            <div class="info-label">SITE:</div>
            <div class="info-value">
                <select id="site-input" style="width: 100%; padding: 5px;">
                    <option value="">Sélectionnez un site</option>
                </select>
            </div>
            <div class="info-label">OBJET:</div>
            <div class="info-value">
                <input type="text" id="object-input" style="width: 100%; padding: 5px;" placeholder="Objet de l'intervention">
            </div>
            <div class="info-label">DATE:</div>
            <div class="info-value">
                <input type="date" id="date-input" style="width: 100%; padding: 5px;">
            </div>
        </div>
    </div>

    <table id="total-table" style="width: 40%; margin-left: auto; margin-bottom: 30px; border: 2px solid #ddd; color:#1976D2">
        <tr>
            <td style="font-weight: bold; padding: 8px;">TOTAL OFFRE USD HT:</td>
            <td style="text-align: right; padding: 8px;"><span id="total-fournitures">-</span></td>
        </tr>
        <tr>
            <td style="font-weight: bold; padding: 8px;">TVA:</td>
            <td style="text-align: right; padding: 8px;"><span id="tva">-</span></td>
        </tr>
        <tr style="background-color: #f2f2f2;">
            <td style="font-weight: bold; padding: 8px;">TOTAL OFFRE USD TTC:</td>
            <td style="text-align: right; padding: 8px;"><span id="total-ttc">-</span></td>
        </tr>
    </table>

    <div class="select-item-section" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
        <h3>Ajouter un article</h3>
        <div style="display: flex; gap: 10px; align-items: center;">
            <div class="search-container" style="flex-grow: 1; position: relative;">
                <div class="item-selector-wrapper">
                    <button id="item-selector" class="item-selector-button" onclick="toggleItemsList()">
                        Sélectionner un article ▼
                    </button>
                    <input type="text" id="item-search" class="item-search-input" placeholder="Rechercher un article..." style="display: none;">
                </div>
                <div id="search-results" class="search-results"></div>
            </div>
            <div class="number-input-container" style="width: auto;">
                <input type="number" id="item-quantity" value="1" min="1" style="padding: 8px; width: 80px; font-size: 20px;" placeholder="Quantité">
            </div>
            <button onclick="addSelectedItem()" style="padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer;">
                Ajouter
            </button>
        </div>
    </div>

    <div class="fournitures-section">
    <h2>FOURNITURES</h2>
    <input type="text" id="fournitures-description" value="en Arrêt de la machine, découpage de l'ancienne isolation, fourniture, et pose de la nouvelle isolation, séchage et remise en service" style="font-size:12px; color:#1976D2; width: 95%; margin: 00px 00px 20px 00px;">

    <div class="rates-section">
        <div class="rate-item">
            <span>Tx de chg:</span>
                <div class="number-input-container">
            <input type="number" id="tx-chg" value="1.15" step="0.01" style="width: 60px; padding: 2px;" onchange="updateRatesAndRecalculate()">
                </div>
        </div>
        <div class="rate-item">
            <span>Tx de marge:</span>
                <div class="number-input-container">
            <input type="number" id="tx-marge" value="0.75" step="0.01" style="width: 60px; padding: 2px;" onchange="updateRatesAndRecalculate()">
                </div>
        </div>
    </div>
    <table id="fournitures-table">
        <thead>
            <tr>
                <th>Description</th>
                <th>Qté</th>
                <th>PR €</th>
                <th>PR $</th>
                <th>PV/u $</th>
                <th>PV $ Total HT</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; background-color: #f9f9f9;">
                <td colspan="5" style="text-align: right;">TOTAL FOURNITURE $ HT:</td>
                <td id="table-total-fournitures" style="text-align: right;">-</td>
                <td></td>
            </tr>
        </tfoot>
    </table>
    </div>

    <div class="MaindOuever-section">
    <h2>MAIN D'OEUVRE</h2>

    <div class="rates-section">
        <div class="rate-item">
            <span>Tx de chg:</span>
            <input type="number" id="mo-tx-chg" value="1.2" step="0.01" style="width: 60px; padding: 2px;" onchange="updateRatesAndRecalculate()">
        </div>
        <div class="rate-item">
            <span>Tx de marge:</span>
            <input type="number" id="mo-tx-marge" value="0.8" step="0.01" style="width: 60px; padding: 2px;" onchange="updateRatesAndRecalculate()">
        </div>
    </div>

    <div class="add-item-section" style="margin-bottom: 20px; padding: 15px; border: 1px solid #ddd; border-radius: 5px;">
        <h3>Ajouter Main d'oeuvre</h3>
        <div style="display: grid; gap: 10px;">
                <div style="display: flex; gap: 20px; align-items: flex-start;">
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <input type="number" id="mo-nb-tech" value="1" min="1" style="padding: 8px; width: 110px;" placeholder="Nb technicien">
                        <span style="font-size: 10px; font-weight: bold; color: #666; margin-top: 2px;">Nb technicien</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                <input type="number" id="mo-nb-hours" value="1" min="1" style="padding: 8px; width: 80px;" placeholder="Nb heures">
                        <span style="font-size: 10px; font-weight: bold; color: #666; margin-top: 2px;">Nb heures</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                <select id="mo-weekend" style="padding: 8px; width: 120px;">
                    <option value="1">1</option>
                    <option value="1.6">1.6</option>
                </select>
                        <span style="font-size: 10px; font-weight: bold; color: #666; margin-top: 2px;">Majo Weekend</span>
                    </div>
                    <div style="display: flex; flex-direction: column; align-items: center;">
                        <input type="number" id="mo-pre" value="10.00" step="0.01" style="padding: 8px; width: 100px;" placeholder="PRÉ">
                        <span style="font-size: 10px; font-weight: bold; color: #666; margin-top: 2px;">PR €</span>
                    </div>
                    <button onclick="addLabor()" style="padding: 8px 15px; background-color: #4CAF50; color: white; border: none; border-radius: 4px; cursor: pointer; margin-top: 8px;">
                    Ajouter
                </button>
            </div>
        </div>
    </div>
        <h3>Chef main d'oeuvre</h3>
        <input type="text" id="mo-description" value="en Arrêt de la machine, découpage de l'ancienne isolation, fourniture, et pose de la nouvelle isolation, séchage et remise en service" style="font-size:12px; color:#1976D2; width: 95%; margin: 00px 00px 20px 00px;">

    <table id="labor-table">
        <thead>
            <tr>
                <th>Nb technicien</th>
                <th>Nb heures</th>
                <th>Majo Weekend</th>
                <th>PR €</th>
                <th>PR $</th>
                <th>PV/u $</th>
                <th>PV $ Total HT</th>
                <th>Actions</th>
            </tr>
        </thead>
        <tbody>
        </tbody>
        <tfoot>
            <tr style="font-weight: bold; background-color: #f9f9f9;">
                <td colspan="5" style="text-align: right;">TOTAL MO $ HT:</td>
                <td id="table-total-mo" style="text-align: right;">-</td>
                <td></td>
            </tr>
        </tfoot>
    </table>
    </div>

    <div class="total-section">
        <div>TOTAL MO $ HT: <span id="total-mo">-</span></div>
    </div>

    <div class="total-section" style="margin-top: 40px; padding-top: 20px; border-top: 2px solid #ddd;">
        <div style="font-size: 1.2em; font-weight: bold;">TOTAL GENERAL: <span id="total-general">-</span></div>
    </div>

    <div class="quote-header">
        <div class="quote-actions">
            <button id="update-quote-btn" class="btn btn-update" style="display: none;" onclick="updateQuote()">Mettre à jour</button>
            <button onclick="saveQuote()" class="btn btn-save">
                Enregistrer
            </button>
            <button onclick="prepareAndPrint()" class="btn btn-print">
                Imprimer
            </button>
        </div>
    </div>

</body>
</html>